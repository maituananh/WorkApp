pipeline {

agent { docker { image 'docker:latest' } }

stages {
    stage("verify tooling") {
      steps {
        sh '''
          docker version
          docker info
          docker-compose version
          curl --version
          jq --version
        '''
      }
    }

    stage('Prune Docker data') {
      steps {
        sh 'docker system prune -a --volumes -f'
      }
    }

    stage('Clone') {
        steps {
           git branch: 'develop', url: 'https://github.com/maituananh/WorkApp.git'
        }
    }

    stage('Docker test') {
        steps {
            sh 'docker --version'
        }
    }

    stage('Docker compose build') {
        steps {
            echo '----------------- This is a docker-compose phase ----------'
            sh 'docker-compose up -d --force-recreate --remove-orphans --build'
        }
    }
  }
}